--- 
layout: post
title: 智能优化算法：模拟退火
tags: 
- "最优化"
- "模拟退火"
status: publish
type: post
published: true
---
前文已经谈到，采用随机搜索优化算法尝试各种题解，虽然简单、直观，但同时也非常低效，因为它得到题解的方式是完全随意跳跃的，并没有充分利用已经得到的优解。要想提高优化算法的性能必须在此基础上进行改进。

# 从爬山法（Hill Climbing）说起

爬山法是对随机搜索的一种改进，它是一种迭代增进得算法，它利用单一解在解空间进行搜寻，并在每次迭代中从当前解得临近解空间中选择一个邻近解。当邻近解的成本函数值比当前解的成本函数值更低时，就以临近解取代当前解，否则就重新在当前解的邻近解空间重新选择一个邻近解。

![模拟退火](/upload/pic/2012-07-18-simulated-annealing1.png "")

爬山法的最大缺陷就在于可能陷入局部范围的最小值，以上图为例，当随机解为上图中的圆点时，算法能找到的具有最低成本的解为点B，而实际上最优解应该为点A，点B它比邻近解表现都好，但却不是全局最优的。

![模拟退火](/upload/pic/2012-07-18-simulated-annealing2.png "")

爬山法的另一个问题是，当随机解出于一个“平台”时，算法将无以事从。如上图所示，算法可能会很快停止搜索，难以找到最优解。

解决上述缺陷的一种方法就是随机重复爬山法（Random-Restart Hill Climbing），即让爬山法以多个随机生成的初始解为起点运行若干次，借此希望其中有一个解能够逼近全局最优。

# 模拟退火算法（Simulated Annealing, SA）的基本思想

模拟退火算法最早的思想由Metropolis等（1953）提出，1983年Kirkpatrick等将其应用于组合优化，它是克服优化过程陷于局部最优和初始值依赖性的方法之一。

模拟退火算法来源于金属退火原理，将金属加温至充分高，再让其徐徐冷却，加温时，金属内部粒子随温升变为无序状，内能增大，而徐徐冷却时粒子渐趋有序，在每个温度都达到平衡态，最后在常温时达到基态，内能减为最小。

其基本思想是把某类优化问题的求解过程与统计热力学的热平衡问题进行对比，试图通过模拟高温物体退火的过程来找到优化问题的全局最优解或近似全局最优解。

![模拟退火](/upload/pic/2012-07-18-simulated-annealing3.png "")

如上图所示，对于一个优化问题，我们可把目标函数看成定义在解空间上的能量曲面，而整个曲面凹凸不平，如果让个光滑圆球在曲面上自由滚动，这个圆球十有八九会滚到附近的凹处停止运动，但该低谷并不一定是最深的一个凹谷。模拟退火方案就是类似于沿水平方向给圆球一个作用力，若该力足够大且小球所处的低谷并不很深，小球受水平力作用会从该低谷滚出，落入另一个低谷，然后受水平力作用又滚出，如此不断滚动。如果作用小球的水平力掌握适当，小球很有可能停留在最深得低谷中，这个最深的低谷就是最优化问题的全局最优解或近似全局最优解。

# 模拟退火算法的基本过程

模拟退火的基本过程如下：

1. 给定初始温度T0及初始点X0，计算该点的函数值f(X0)；
2. 随机产生扰动ΔX，得到新点X = X0 + ΔX，计算新点的函数值f(X)及函数差值Δf = f(X) – f(X0)；
3. 若Δf <= 0，则接受新点X，作为下一次模拟退火的初始点；
4. 若Δf >= 0 ，则计算新点的接受概率P(Δf) = exp(-Δf/Tk)，产生[0,1]区间的均匀分布的伪随机数r（r>=0且r<=1），若P(Δf) >= r，则接受新点作为下一次模拟的初始点，否则放弃新点，仍取原来的点作为下一次模拟的初始点

# 模拟退火算法的关键参数控制

模拟退火的执行过程中，算法效果取决于一组控制参数的选择。模拟退火的关键参数包括初始温度，温度下降方法，每一温度迭代长度，终止准则。


### 初始温度的控制

初始温度高，则搜索到全局最优解的可能性大，但因此要花费大量的计算时间；反之，则可节约计算时间，但全局搜索性能可能受到影响，使搜索到全局最优解的可能性减小。实际应用过程中，初始温度一般需要依据实验结果进行若干次调整，一般温度初值T0取较大值。


### 温度下降方法的控制

如果温度下降过快可能就会丢失极值点；如果温度下降过慢，收敛速度又会大大降低，导致计算时间过长。在实际问题中，通常采用两种非常直观的下降方法：

+ 每一步温度以相同比率下降，即T(k+1) = Tk *α，其中α>0且α<1，为降温系数；
+ 每一步温度以相同迭代长度下降，即Tk = T0 * (N – k)/N，其中T0为初始温度，N为温度下降的总次数;
+ 每一温度迭代长度的控制

一般的，同一温度下的充分搜索是必要的，但需以计算时间增加为代价。实际中常根据问题的特点来设置合理的迭代长度，常用两种方法：

+ 固定的迭代步数，即在每一温度都设置相同的迭代步数；
+ 高温时，各状态被接受的概率基本相同，且几乎都被接受，可使同一温度的迭代步数尽量少；温度逐渐变低后，越来越多的状态被拒绝，则可相应增加迭代的步数。可给定一个迭代步数上限S和接受次数上限R，当某一温度的实际接受次数等于R时，不再迭代，否则迭代到上限步数S。


### 终止准则

模拟退火的终止准则主要采用比较直观的方法：

+ 零度法： 给定一个比较小的正数n，当温度Tk <= n时，算法终止，表示达到了最低温度；
+ 循环总数控制法：设置温度下降的次数为一定值N，当温度迭代次数达到N时，算法终止。
+ 基于不改进规则的控制法：在一个温度和给定的迭代次数内没有改进当前的局部最优解，则算法终止；
+ 接受概率终止准则：给定一个较小的概率P。在一个温度和给定的迭代步数内，除当前局部最优解外，其他状态的接受概率都小于P，算法终止。
